<template>
  <header>
    <client-only>
      <AsideMenu :is-open="isAsideOpen" @aside-close="isAsideOpen = false" />
    </client-only>
    <div class="container">
      <div class="header-wrapper">
        <nuxt-link to="/" tag="a" class="main-logo"
          ><img src="~assets/img/main-logo.svg" alt="main logo"
        /></nuxt-link>
        <div class="input-default">
          <input
            id="header-search"
            v-model="searchInput"
            type="text"
            autocomplete="false"
            @input="debouncedSearch"
            @keypress.enter="search"
          />
          <label for="header-search">
            <svg
              width="16"
              height="16"
              viewBox="0 0 16 16"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M0 15.192L4.31543 10.8766C3.27841 9.63164 2.76128 8.03479 2.87162 6.41826C2.98197 4.80173 3.71128 3.28997 4.90786 2.19747C6.10444 1.10497 7.67615 0.515845 9.29602 0.552652C10.9159 0.589458 12.4592 1.24936 13.6049 2.39508C14.7507 3.5408 15.4106 5.08413 15.4474 6.70401C15.4842 8.32388 14.8951 9.89559 13.8026 11.0922C12.7101 12.2887 11.1983 13.0181 9.58177 13.1284C7.96524 13.2388 6.36839 12.7216 5.12343 11.6846L0.808 16L0 15.192ZM14.2857 6.85717C14.2857 5.84001 13.9841 4.84569 13.419 3.99996C12.8539 3.15422 12.0507 2.49504 11.1109 2.10579C10.1712 1.71654 9.13715 1.6147 8.13954 1.81314C7.14192 2.01157 6.22555 2.50138 5.50631 3.22062C4.78707 3.93987 4.29726 4.85624 4.09882 5.85385C3.90038 6.85147 4.00222 7.88553 4.39148 8.82526C4.78073 9.76499 5.4399 10.5682 6.28564 11.1333C7.13138 11.6984 8.1257 12 9.14286 12C10.5064 11.9985 11.8136 11.4562 12.7777 10.4921C13.7419 9.52791 14.2842 8.22068 14.2857 6.85717Z"
                fill="white"
              />
            </svg>
          </label>
          <a
            v-if="searchInput"
            href=""
            class="delete"
            @click.prevent="searchInput = ''"
          >
            <IconCrossSvg />
          </a>
        </div>
        <div class="mobile-wrapper">
          <div class="mobile-wrapper2">
            <div class="btn-wrapper">
              <nuxt-link
                v-if="$auth.user"
                class="person d-flex"
                to="/personal"
                @click.prevent
              >
                <div class="text-2 mr-2">
                  {{ fullname }}
                </div>
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M22 22.492H22.502L22.5 21.99C22.4975 21.3703 22.1418 19.7627 20.6896 18.3104C19.2743 16.8952 16.6837 15.5 12 15.5C7.31424 15.5 4.72563 16.8953 3.31045 18.3104C1.85751 19.7634 1.50503 21.3707 1.50002 21.9879L1.49592 22.492H2H22ZM15.8891 9.88909C14.8576 10.9205 13.4587 11.5 12 11.5C10.5413 11.5 9.14236 10.9205 8.11091 9.88909C7.07946 8.85764 6.5 7.45869 6.5 6C6.5 4.54131 7.07946 3.14236 8.11091 2.11091C9.14236 1.07946 10.5413 0.5 12 0.5C13.4587 0.5 14.8576 1.07946 15.8891 2.11091C16.9205 3.14236 17.5 4.54131 17.5 6C17.5 7.45869 16.9205 8.85764 15.8891 9.88909ZM15.182 9.18198C16.0259 8.33807 16.5 7.19347 16.5 6C16.5 4.80653 16.0259 3.66193 15.182 2.81802C14.3381 1.97411 13.1935 1.5 12 1.5C10.8065 1.5 9.66193 1.97411 8.81802 2.81802C7.9741 3.66193 7.5 4.80653 7.5 6C7.5 7.19347 7.9741 8.33807 8.81802 9.18198C9.66193 10.0259 10.8065 10.5 12 10.5C13.1935 10.5 14.3381 10.0259 15.182 9.18198ZM23.5 22C23.5 22.4125 23.3983 22.6886 23.2715 22.8789C23.1426 23.0723 22.9671 23.2074 22.7764 23.3028C22.5837 23.3991 22.3851 23.4498 22.2303 23.4756C22.1541 23.4883 22.0917 23.4944 22.0503 23.4974C22.0353 23.4984 22.0232 23.4991 22.0144 23.4995C22.0111 23.4996 22.0082 23.4997 22.0058 23.4998L21.9984 23.5L21.9991 23.5H21.9978H2.00218H2.00089L2.0016 23.5L1.9942 23.4998C1.98544 23.4995 1.9703 23.4988 1.94969 23.4974C1.90829 23.4944 1.84589 23.4883 1.7697 23.4756C1.61495 23.4498 1.41625 23.3991 1.22361 23.3028C1.03292 23.2074 0.857447 23.0723 0.728525 22.8789C0.60169 22.6886 0.5 22.4125 0.5 22C0.5 21.1284 0.950272 19.2568 2.60355 17.6036C4.24218 15.9649 7.10545 14.5 12 14.5C16.8946 14.5 19.7578 15.9649 21.3964 17.6036C23.0497 19.2568 23.5 21.1284 23.5 22Z"
                    stroke="#01FFDB"
                  />
                </svg>
              </nuxt-link>
            </div>
            <a
              v-b-modal.subscribe-to-news
              class="news"
              @click.prevent="$bvModal.show('subscribe-to-news')"
            >
              <h6>Подписаться на новости</h6>
              <svg
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <path
                  d="M20.1 2.90002H20.1C20.9685 2.89997 21.804 3.23223 22.4353 3.82867C23.0648 4.42348 23.4436 5.23605 23.4944 6.10047L23.5 6.30679V17.7V17.7001C23.5001 18.5685 23.1678 19.4041 22.5714 20.0353C21.9765 20.6649 21.164 21.0436 20.2996 21.0944L20.0932 21.1H3.9H3.89997C3.03152 21.1001 2.19596 20.7678 1.56471 20.1714C0.935183 19.5766 0.556439 18.764 0.505609 17.8996L0.5 17.6932V6.30002V6.29999C0.499943 5.43154 0.83221 4.59599 1.42864 3.96473C2.02344 3.33521 2.836 2.95646 3.7004 2.90563L3.90679 2.90002H20.1ZM22.7 8.84762V8.0194L21.9671 8.40518L12.1871 13.5532L12.1865 13.5535C12.1374 13.5794 12.0834 13.5949 12.0281 13.5988C11.9773 13.6024 11.9263 13.5963 11.8779 13.5809L11.7981 13.546L2.03287 8.40636L1.3 8.02064V8.84882V17.7V17.7C1.30002 18.3526 1.5454 18.9812 1.98741 19.4612C2.42942 19.9412 3.03576 20.2374 3.68606 20.2911L3.69621 20.292L3.70638 20.2924L3.87918 20.2996L3.88958 20.3H3.9H20.1H20.1C20.7528 20.3 21.3816 20.0544 21.8617 19.6121C22.3417 19.1697 22.6378 18.563 22.6911 17.9125L22.6919 17.9025L22.6924 17.8926L22.6996 17.721L22.7 17.7105V17.7V8.84762ZM20.121 3.70046L20.1105 3.70002H20.1H3.9H3.89998C3.24747 3.70005 2.61882 3.94542 2.13883 4.38743C1.65883 4.82945 1.36259 5.43578 1.3089 6.08608L1.30806 6.09623L1.30763 6.10641L1.30043 6.27921L1.3 6.28961V6.30002V6.81482V7.11671L1.56715 7.2573L11.7672 12.6249L12 12.7474L12.2329 12.6249L22.4329 7.25608L22.7 7.11548V6.81362V6.30002V6.29998C22.6999 5.64724 22.4544 5.01839 22.012 4.53836C21.5697 4.05833 20.963 3.76224 20.3125 3.7089L20.3025 3.70808L20.2926 3.70766L20.121 3.70046Z"
                  fill="#01FFDB"
                  stroke="#01FFDB"
                />
              </svg>
            </a>
            <div class="d-flex justify-content-between row btn-wrapper mr-2">
              <nuxt-link to="/favourites" class="favorite">
                <svg
                  width="20"
                  height="24"
                  viewBox="0 0 20 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M17.407 0H6.38306C5.89577 0 5.42844 0.193574 5.08387 0.538139C4.73931 0.882703 4.54573 1.35003 4.54573 1.83732V3.67464H2.70841C2.22113 3.67464 1.7538 3.86822 1.40923 4.21278C1.06467 4.55734 0.871094 5.02467 0.871094 5.51196V22.9665C0.871094 23.2102 0.967881 23.4438 1.14016 23.6161C1.31245 23.7884 1.54611 23.8852 1.78975 23.8852C1.98307 23.8845 2.17151 23.8244 2.32947 23.7129L8.22038 19.4986L14.1228 23.7129C14.2589 23.8132 14.4207 23.8729 14.5894 23.8851C14.758 23.8973 14.9267 23.8615 15.0759 23.7818C15.2241 23.7031 15.3482 23.5858 15.4351 23.4422C15.5221 23.2987 15.5686 23.1343 15.5697 22.9665V18.4536L17.7974 20.0383C17.9504 20.151 18.1356 20.2114 18.3256 20.2105C18.5693 20.2105 18.8029 20.1137 18.9752 19.9415C19.1475 19.7692 19.2443 19.5355 19.2443 19.2919V1.83732C19.2443 1.35003 19.0507 0.882703 18.7062 0.538139C18.3616 0.193574 17.8943 0 17.407 0ZM13.7323 21.1866L8.74861 17.6268C8.59561 17.5141 8.41039 17.4537 8.22038 17.4545C8.02706 17.4552 7.83862 17.5153 7.68066 17.6268L2.70841 21.1866V5.51196H13.7323V21.1866ZM17.407 17.512L15.5697 16.1914V5.51196C15.5697 5.02467 15.3761 4.55734 15.0315 4.21278C14.687 3.86822 14.2196 3.67464 13.7323 3.67464H6.38306V1.83732H17.407V17.512Z"
                    fill="#01FFDB"
                  />
                </svg>
                <span>{{ favouritesCount }}</span>
              </nuxt-link>

              <nuxt-link to="/cart" class="cart" href="">
                <svg
                  width="24"
                  height="24"
                  viewBox="0 0 24 24"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    d="M9 22C9.55228 22 10 21.5523 10 21C10 20.4477 9.55228 20 9 20C8.44772 20 8 20.4477 8 21C8 21.5523 8.44772 22 9 22Z"
                    stroke="#01FFDB"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M20 22C20.5523 22 21 21.5523 21 21C21 20.4477 20.5523 20 20 20C19.4477 20 19 20.4477 19 21C19 21.5523 19.4477 22 20 22Z"
                    stroke="#01FFDB"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                  <path
                    d="M1 1H5L7.68 14.39C7.77144 14.8504 8.02191 15.264 8.38755 15.5583C8.75318 15.8526 9.2107 16.009 9.68 16H19.4C19.8693 16.009 20.3268 15.8526 20.6925 15.5583C21.0581 15.264 21.3086 14.8504 21.4 14.39L23 6H6"
                    stroke="#01FFDB"
                    stroke-width="2"
                    stroke-linecap="round"
                    stroke-linejoin="round"
                  />
                </svg>
                <span>{{ isAuth ? basketAuthCount : basketLocalCount }}</span>
              </nuxt-link>
            </div>
            <!--            <client-only>-->
            <!--              <a href="" class="search-mob-a">-->
            <!--                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">-->
            <!--                  <path d="M23.9999 22.7884L17.5268 16.3153C19.0823 14.4478 19.858 12.0526 19.6925 9.62776C19.527 7.20296 18.433 4.93532 16.6381 3.29657C14.8433 1.65782 12.4857 0.774134 10.0559 0.829344C7.62607 0.884554 5.31108 1.87441 3.59249 3.59299C1.87391 5.31157 0.884058 7.62656 0.828848 10.0564C0.773638 12.4862 1.65732 14.8438 3.29607 16.6386C4.93482 18.4335 7.20246 19.5275 9.62726 19.693C12.0521 19.8585 14.4473 19.0828 16.3148 17.5273L22.7879 24.0004L23.9999 22.7884ZM2.57135 10.2861C2.57135 8.76039 3.02378 7.26891 3.87144 6.0003C4.71909 4.73169 5.9239 3.74293 7.3335 3.15906C8.7431 2.57518 10.2942 2.42241 11.7906 2.72007C13.287 3.01773 14.6616 3.75244 15.7405 4.8313C16.8193 5.91017 17.554 7.28472 17.8517 8.78115C18.1493 10.2776 17.9966 11.8287 17.4127 13.2383C16.8288 14.6479 15.8401 15.8527 14.5715 16.7003C13.3029 17.548 11.8114 18.0004 10.2856 18.0004C8.24037 17.9981 6.27953 17.1847 4.83331 15.7384C3.3871 14.2922 2.57361 12.3314 2.57135 10.2861Z" fill="#01FFDB"/>-->
            <!--                </svg>-->
            <!--              </a>-->
            <!--            </client-only>-->
          </div>
          <a
            v-if="!$auth.user"
            v-b-modal.login-form
            class="autho"
            @click="$bvModal.show('login-form')"
          >
            <h6>Авторизоваться</h6>
            <svg
              width="24"
              height="24"
              viewBox="0 0 24 24"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M6.76928 7.25C6.76928 7.80228 7.217 8.25 7.76928 8.25C8.32157 8.25 8.76928 7.80228 8.76928 7.25H6.76928ZM20.8846 3V2V3ZM23 17.875H22H23ZM8.76928 15.75C8.76928 15.1977 8.32157 14.75 7.76928 14.75C7.217 14.75 6.76928 15.1977 6.76928 15.75H8.76928ZM12.1374 15.0445C11.7478 15.4359 11.7492 16.0691 12.1406 16.4587C12.532 16.8483 13.1652 16.8469 13.5548 16.4555L12.1374 15.0445ZM17.0769 11.5L17.7856 12.2055C18.174 11.8153 18.174 11.1847 17.7856 10.7945L17.0769 11.5ZM13.5548 6.5445C13.1652 6.15309 12.532 6.15165 12.1406 6.54129C11.7492 6.93093 11.7478 7.56409 12.1374 7.9555L13.5548 6.5445ZM1 10.5C0.447715 10.5 0 10.9477 0 11.5C0 12.0523 0.447715 12.5 1 12.5V10.5ZM16.2307 12.5C16.783 12.5 17.2307 12.0523 17.2307 11.5C17.2307 10.9477 16.783 10.5 16.2307 10.5V12.5ZM8.76928 7.25V5.125H6.76928V7.25H8.76928ZM8.76928 5.125C8.76928 4.82517 8.88789 4.53853 9.09757 4.3279L7.68015 2.9169C7.09641 3.50329 6.76928 4.29766 6.76928 5.125H8.76928ZM9.09757 4.3279C9.3071 4.11742 9.59031 4 9.88466 4V2C9.05694 2 8.26405 2.33035 7.68015 2.9169L9.09757 4.3279ZM9.88466 4H20.8846V2H9.88466V4ZM20.8846 4C21.179 4 21.4622 4.11742 21.6717 4.3279L23.0891 2.9169C22.5052 2.33035 21.7123 2 20.8846 2V4ZM21.6717 4.3279C21.8814 4.53853 22 4.82517 22 5.125H24C24 4.29766 23.6729 3.50329 23.0891 2.9169L21.6717 4.3279ZM22 5.125V17.875H24V5.125H22ZM22 17.875C22 18.1748 21.8814 18.4615 21.6717 18.6721L23.0891 20.0831C23.6729 19.4967 24 18.7023 24 17.875H22ZM21.6717 18.6721C21.4622 18.8826 21.179 19 20.8846 19V21C21.7123 21 22.5052 20.6697 23.0891 20.0831L21.6717 18.6721ZM20.8846 19H9.88466V21H20.8846V19ZM9.88466 19C9.59031 19 9.3071 18.8826 9.09757 18.6721L7.68015 20.0831C8.26405 20.6697 9.05694 21 9.88466 21V19ZM9.09757 18.6721C8.88789 18.4615 8.76928 18.1748 8.76928 17.875H6.76928C6.76928 18.7023 7.09641 19.4967 7.68015 20.0831L9.09757 18.6721ZM8.76928 17.875V15.75H6.76928V17.875H8.76928ZM13.5548 16.4555L17.7856 12.2055L16.3682 10.7945L12.1374 15.0445L13.5548 16.4555ZM17.7856 10.7945L13.5548 6.5445L12.1374 7.9555L16.3682 12.2055L17.7856 10.7945ZM1 12.5H16.2307V10.5H1V12.5Z"
                fill="#01FFDB"
              />
            </svg>
          </a>
        </div>
        <nuxt-link to="/search" tag="a" class="mobile-search">
          <search-svg />
        </nuxt-link>
        <a
          v-b-modal.subscribe-to-news
          class="news d-none"
          @click.prevent="$bvModal.show('subscribe-to-news')"
        >
          <svg
            width="24"
            height="24"
            viewBox="0 0 24 24"
            fill="none"
            xmlns="http://www.w3.org/2000/svg"
          >
            <path
              d="M20.1 2.90002H20.1C20.9685 2.89997 21.804 3.23223 22.4353 3.82867C23.0648 4.42348 23.4436 5.23605 23.4944 6.10047L23.5 6.30679V17.7V17.7001C23.5001 18.5685 23.1678 19.4041 22.5714 20.0353C21.9765 20.6649 21.164 21.0436 20.2996 21.0944L20.0932 21.1H3.9H3.89997C3.03152 21.1001 2.19596 20.7678 1.56471 20.1714C0.935183 19.5766 0.556439 18.764 0.505609 17.8996L0.5 17.6932V6.30002V6.29999C0.499943 5.43154 0.83221 4.59599 1.42864 3.96473C2.02344 3.33521 2.836 2.95646 3.7004 2.90563L3.90679 2.90002H20.1ZM22.7 8.84762V8.0194L21.9671 8.40518L12.1871 13.5532L12.1865 13.5535C12.1374 13.5794 12.0834 13.5949 12.0281 13.5988C11.9773 13.6024 11.9263 13.5963 11.8779 13.5809L11.7981 13.546L2.03287 8.40636L1.3 8.02064V8.84882V17.7V17.7C1.30002 18.3526 1.5454 18.9812 1.98741 19.4612C2.42942 19.9412 3.03576 20.2374 3.68606 20.2911L3.69621 20.292L3.70638 20.2924L3.87918 20.2996L3.88958 20.3H3.9H20.1H20.1C20.7528 20.3 21.3816 20.0544 21.8617 19.6121C22.3417 19.1697 22.6378 18.563 22.6911 17.9125L22.6919 17.9025L22.6924 17.8926L22.6996 17.721L22.7 17.7105V17.7V8.84762ZM20.121 3.70046L20.1105 3.70002H20.1H3.9H3.89998C3.24747 3.70005 2.61882 3.94542 2.13883 4.38743C1.65883 4.82945 1.36259 5.43578 1.3089 6.08608L1.30806 6.09623L1.30763 6.10641L1.30043 6.27921L1.3 6.28961V6.30002V6.81482V7.11671L1.56715 7.2573L11.7672 12.6249L12 12.7474L12.2329 12.6249L22.4329 7.25608L22.7 7.11548V6.81362V6.30002V6.29998C22.6999 5.64724 22.4544 5.01839 22.012 4.53836C21.5697 4.05833 20.963 3.76224 20.3125 3.7089L20.3025 3.70808L20.2926 3.70766L20.121 3.70046Z"
              fill="#01FFDB"
              stroke="#01FFDB"
            />
          </svg>
        </a>
        <div class="hamburger" @click="asideOpen()">
          <span></span>
          <span></span>
          <span></span>
        </div>
      </div>
      <BottomMenu />
    </div>
    <client-only>
      <LoginForm />
      <SubscribeToNews />
      <SubscribeToNewsSuccess />
      <ReviewSend />
      <SomethingWrong />
    </client-only>
  </header>
</template>

<script>
import SearchMixin from '~/components/mixins/SearchMixin'
export default {
  name: 'DefaultHeader',

  fetchOnServer: true,

  mixins: [SearchMixin],

  // async asyncData({ $store }) {
  //   await $store.dispatch('setting/fetchSetting')
  // },

  data() {
    return {
      isAsideOpen: false,
      isLoginFormOpen: false,
      form: {
        login: null,
        password: null,
      },
    }
  },
  computed: {
    isAuth() {
      return Boolean(this.$auth.user)
    },
    error() {
      return this.$store.getters['errors/getShowErrorModal']
    },
    fullname() {
      return (
        this.$auth?.user?.name +
        ' ' +
        this.$auth?.user?.surname +
        ' ' +
        this.$auth?.user?.patronymic?.[0] +
        '.'
      )
    },
    favouritesCount() {
      return this.$store.getters['favourites/getFavouritesCount'] || 0
    },
    basketLocalCount() {
      return this.$store.getters['cart/getLocalCartCount'] || 0
    },
    basketAuthCount() {
      return this.$store.getters['cart/getAuthCartCount'] || 0
    },
    cartCount() {
      return this.$store.getters['cart/getCartCount'] || 0
    },
  },
  methods: {
    asideOpen() {
      this.isAsideOpen = true
    },
    loginFormOpen() {
      this.isLoginFormOpen = true
    },
  },
}
</script>

<style scoped></style>
